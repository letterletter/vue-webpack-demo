import*as e from"react";import*as t from"antd";var n={4988:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",a=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),a&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),a&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,a,r,o){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(a)for(var u=0;u<this.length;u++){var l=this[u][0];null!=l&&(i[l]=!0)}for(var c=0;c<e.length;c++){var s=[].concat(e[c]);a&&i[s[0]]||(void 0!==o&&(void 0===s[5]||(s[1]="@layer".concat(s[5].length>0?" ".concat(s[5]):""," {").concat(s[1],"}")),s[5]=o),n&&(s[2]?(s[1]="@media ".concat(s[2]," {").concat(s[1],"}"),s[2]=n):s[2]=n),r&&(s[4]?(s[1]="@supports (".concat(s[4],") {").concat(s[1],"}"),s[4]=r):s[4]="".concat(r)),t.push(s))}},t}},8371:e=>{e.exports=function(e){return e[1]}},6424:(e,t,n)=>{n.d(t,{A:()=>u});var a=n(8371),r=n.n(a),o=n(4988),i=n.n(o)()(r());i.push([e.id,".wrap-f5ce9 .ant-empty {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  z-index: 10;\n  transform: translate(-50%, -60%);\n}\n.wrap-f5ce9 > div:nth-child(2) {\n  height: 100px !important;\n  background-color: #ffff;\n}\n",""]),i.locals={wrap:"wrap-f5ce9"};const u=i},1717:(e,t,n)=>{n.d(t,{A:()=>u});var a=n(8371),r=n.n(a),o=n(4988),i=n.n(o)()(r());i.push([e.id,".domainContainer-b73c1 .queryContent-a43cb {\n  position: relative;\n  margin-bottom: 12px;\n  display: flex;\n}\n.domainContainer-b73c1 .queryContent-a43cb .queryContentLeft-e2415 {\n  flex: 1;\n}\n.domainContainer-b73c1 .queryContent-a43cb .queryContentRight-a0e83 {\n  display: flex;\n  align-items: flex-end;\n  margin-bottom: 24px;\n}\n.domainContainer-b73c1 .actionsContent-af85e {\n  position: relative;\n  margin-bottom: 12px;\n  text-align: right;\n}\n.domainContainer-b73c1 .tableContent-e9791 {\n  position: relative;\n}\n.domainContainer-b73c1 .empty-dd328 {\n  padding: 24px 0;\n}\n",""]),i.locals={domainContainer:"domainContainer-b73c1",queryContent:"queryContent-a43cb",queryContentLeft:"queryContentLeft-e2415",queryContentRight:"queryContentRight-a0e83",actionsContent:"actionsContent-af85e",tableContent:"tableContent-e9791",empty:"empty-dd328"};const u=i},5072:e=>{var t=[];function n(e){for(var n=-1,a=0;a<t.length;a++)if(t[a].identifier===e){n=a;break}return n}function a(e,a){for(var o={},i=[],u=0;u<e.length;u++){var l=e[u],c=a.base?l[0]+a.base:l[0],s=o[c]||0,d="".concat(c," ").concat(s);o[c]=s+1;var f=n(d),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==f)t[f].references++,t[f].updater(p);else{var m=r(p,a);a.byIndex=u,t.splice(u,0,{identifier:d,updater:m,references:1})}i.push(d)}return i}function r(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,r){var o=a(e=e||[],r=r||{});return function(e){e=e||[];for(var i=0;i<o.length;i++){var u=n(o[i]);t[u].references--}for(var l=a(e,r),c=0;c<o.length;c++){var s=n(o[c]);0===t[s].references&&(t[s].updater(),t.splice(s,1))}o=l}}},7659:e=>{var t={};e.exports=function(e,n){var a=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(n)}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},4868:e=>{e.exports=function(e,t){Object.keys(t).forEach((function(n){e.setAttribute(n,t[n])}))}},7825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var a="";n.supports&&(a+="@supports (".concat(n.supports,") {")),n.media&&(a+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(a+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),a+=n.css,r&&(a+="}"),n.media&&(a+="}"),n.supports&&(a+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(a,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},1113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},a={};function r(e){var t=a[e];if(void 0!==t)return t.exports;var o=a[e]={id:e,exports:{}};return n[e](o,o.exports,r),o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var o={};(()=>{r.d(o,{A:()=>B});const n=(a={default:()=>e.default,useCallback:()=>e.useCallback,useEffect:()=>e.useEffect,useRef:()=>e.useRef},i={},r.d(i,a),i);var a,i;const u=(e=>{var t={};return r.d(t,e),t})({Button:()=>t.Button,Empty:()=>t.Empty,message:()=>t.message});var l=r(5072),c=r.n(l),s=r(7825),d=r.n(s),f=r(7659),p=r.n(f),m=r(4868),v=r.n(m),E=r(540),g=r.n(E),C=r(1113),y=r.n(C),T=r(6424),h={attributes:{title:"less"}};h.styleTagTransform=y(),h.setAttributes=v(),h.insert=p().bind(null,"head"),h.domAPI=d(),h.insertStyleElement=g(),c()(T.A,h);const S=T.A&&T.A.locals?T.A.locals:void 0;function N(e){var t=e.slot,a=e.description;return n.default.createElement("div",{className:S.wrap},n.default.createElement(u.Empty,{imageStyle:{height:45},description:a||"可拖拽组件"}),t)}var A=r(1717),R={attributes:{title:"less"}};R.styleTagTransform=y(),R.setAttributes=v(),R.insert=p().bind(null,"head"),R.domAPI=d(),R.insertStyleElement=g(),c()(A.A,R);const b=A.A&&A.A.locals?A.A.locals:void 0;var I,P,U,D,M,O,L,_,q=function(){return q=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},q.apply(this,arguments)};!function(e){e.STRING="string",e.NUMBER="number",e.DATETIME="datetime",e.HREF="href",e.PHONE="phone",e.EMAIL="email",e.IMAGE="image",e.APPEND_FILE="appendFile",e.ENUM="enum",e.RELATION="relation",e.MAPPING="mapping",e.SYS_USER="SYS_USER",e.SYS_USER_CREATOR="SYS_USER.CREATOR",e.SYS_USER_UPDATER="SYS_USER.UPDATER",e.FRONT_CUSTOM="FRONT_CUSTOM"}(U||(U={})),function(e){e.VARCHAR="varchar",e.BIGINT="bigint",e.MEDIUMTEXT="mediumtext"}(D||(D={})),function(e){e.CURRENT_TIME="$currentTime"}(M||(M={})),function(e){e.CREATE="create",e.EDIT="edit"}(O||(O={})),function(e){e.INPUT="Input",e.TEXTAREA="Textarea",e.RICH_TEXT="RichText",e.INPUT_NUMBER="InputNumber",e.SELECT="Select",e.DATE_PICKER="DatePicker",e.UPLOAD="Upload",e.IMAGE_UPLOAD="ImageUpload",e.RADIO="Radio",e.CHECKBOX="Checkbox",e.DEBOUNCE_SELECT="DebounceSelect",e.USER_PROFILE="UserProfile"}(L||(L={})),(I={})[U.STRING]=L.INPUT,I[U.NUMBER]=L.INPUT_NUMBER,I[U.DATETIME]=L.DATE_PICKER,I[U.HREF]=L.INPUT,I[U.PHONE]=L.INPUT,I[U.EMAIL]=L.INPUT,I[U.IMAGE]=L.IMAGE_UPLOAD,I[U.APPEND_FILE]=L.UPLOAD,I[U.ENUM]=L.RADIO,I[U.RELATION]=L.DEBOUNCE_SELECT,I[U.MAPPING]=L.DEBOUNCE_SELECT,I[U.SYS_USER]=L.DEBOUNCE_SELECT,I[U.SYS_USER_CREATOR]=L.DEBOUNCE_SELECT,I[U.SYS_USER_UPDATER]=L.DEBOUNCE_SELECT,(P={})[L.INPUT]="LIKE",P[L.TEXTAREA]="LIKE",P[L.INPUT_NUMBER]="=",P[L.SELECT]="=",P[L.DATE_PICKER]="=",P[L.UPLOAD]="=",P[L.IMAGE_UPLOAD]="=",P[L.RADIO]="=",P[L.CHECKBOX]="=",P[L.DEBOUNCE_SELECT]="=",function(e){e.NORMAL="normal",e.SLOT="slot"}(_||(_={}));var x={QUERY:{THEN:"queryThen",CATCH:"queryCatch"},INSERT:{THEN:"createThen",CATCH:"createCatch"},EDIT:{THEN:"editByIdThen",CATCH:"editByIdCatch"},DELETE:{THEN:"deleteByIdThen",CATCH:"deleteByIdCatch"},PAGE_CHANGE:{THEN:"pageChangeThen",CATCH:"pageChangeCatch"}},z=function e(t,n,a){if(void 0===n&&(n=""),void 0===a&&(a=[]),!Array.isArray(null==t?void 0:t.fieldAry)||a.includes(t.id))return[];a.push(t.id);var r=[];return t.fieldAry.filter((function(e){return!e.isPrivate})).forEach((function(t){var o;if(["relation","mapping"].includes(t.bizType)){var i=e(null===(o=t.mapping)||void 0===o?void 0:o.entity,t.name,a);r.push.apply(r,i)}else r.push({value:t.id,label:n?"".concat(n,".").concat(t.name):t.name})})),r},H=function(e){var t=e.getOutputs,n=e.eventName,a=e.cb;return function(e){var r,o,i=null===(o=null===(r=t())||void 0===r?void 0:r[n])||void 0===o?void 0:o.getConnections();if(!Array.isArray(i)||!i.length)return a(e)}},w=function(){return w=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},w.apply(this,arguments)};function B(e){var t,a,r,o,i,l,c=e.env,s=e.data,d=(e.outputs,e.inputs),f=e.slots,p=(e.createPortal,(0,n.useRef)(null)),m=(0,n.useRef)(),v=(0,n.useRef)(),E=(0,n.useRef)(),g=(0,n.useRef)(),C=(0,n.useRef)(1),y=(0,n.useRef)({}),T=(0,n.useRef)([]),h=null===(a=null===(t=s.domainModel)||void 0===t?void 0:t.query)||void 0===a?void 0:a.abilitySet;(0,n.useEffect)((function(){c.runtime&&(d.query((function(e,t){C.current=1,A(e,{pageNum:1,pageSize:s.pageSize},!0,t)})),d.pageChange((function(e,t){C.current=e.pageNum,A(y.current,{pageNum:e.pageNum,pageSize:s.pageSize},!1,t)})),d.create((function(e,t){var n,a,r;F(h,"INSERT")?(n=c.callDomainModel,a=s.domainModel,r=w({},e),new Promise((function(e,t){n?n(a,"INSERT",{query:r}).then((function(n){1===n.code?e(n.data):t(n.msg||"请求错误，请稍候再试~")})).catch((function(e){console.error(e),t("请求错误，请稍候再试~")})):t("env.callDomainModel 未实现")}))).then((function(e){t[x.INSERT.THEN](null==e?void 0:e.response),u.message.success("创建成功"),A(y.current,{pageNum:C.current,pageSize:s.pageSize})})).catch((function(e){t[x.INSERT.CATCH](e),u.message.error(e)})):u.message.warn("未支持新建操作")})),d.editById((function(e,t){var n,a,r;F(h,"UPDATE")?(n=c.callDomainModel,a=s.domainModel,r=w({},e),new Promise((function(e,t){n?n(a,"UPDATE",{query:q({},r)}).then((function(n){1===n.code?e(n.data):t(n.msg||"请求错误，请稍候再试~")})).catch((function(e){console.error(e),t("请求错误，请稍候再试~")})):t("env.callDomainModel 未实现")}))).then((function(e){u.message.success("更新成功"),t[x.EDIT.THEN](null==e?void 0:e.response),A(y.current,{pageNum:C.current,pageSize:s.pageSize})})).catch((function(e){t[x.EDIT.CATCH](e),u.message.error(e)})):u.message.warn("未支持编辑操作")})),d.deleteById((function(e,t){var n,a,r;F(h,"DELETE")?(n=c.callDomainModel,a=s.domainModel,r=w({},e),new Promise((function(e,t){n?n(a,"DELETE",{query:r}).then((function(n){1===n.code?e(n.data):t(n.msg||"请求错误，请稍候再试~")})).catch((function(e){console.error(e),t("请求错误，请稍候再试~")})):t("env.callDomainModel 未实现")}))).then((function(e){u.message.success("删除成功"),t[x.DELETE.THEN](null==e?void 0:e.response),A(y.current,{pageNum:C.current,pageSize:s.pageSize})})).catch((function(e){t[x.DELETE.CATCH](e),u.message.error(e)})):u.message.warn("未支持删除操作")})))}),[]),(0,n.useEffect)((function(){var e;if(c.runtime){if(!s.domainModel)return;s.isImmediate&&(E.current?null===(e=E.current)||void 0===e||e.submit().onFinish((function(e){A(e,{pageNum:1,pageSize:s.pageSize},!0)})):A({},{pageNum:1,pageSize:s.pageSize},!0))}}),[]);var S=(0,n.useCallback)((function(e){var t;c.runtime&&"submit"===e.key&&(null===(t=E.current)||void 0===t||t.submit().onFinish((function(e){C.current=1,A(e,{pageNum:1,pageSize:s.pageSize},!0)})))}),[]),A=function(e,t,n,a){return new Promise((function(r,o){var i,l,d,f,p,v,E;null===(l=null===(i=null==m?void 0:m.current)||void 0===i?void 0:i.startLoading)||void 0===l||l.call(i);var g=e,C=T.current;"domain"===s.domainModel.type&&n&&(g=function(e){var t=e.values,n=e.fieldsRules,a={};return t&&Object.keys(t).forEach((function(e){var r,o=t[e];"string"==typeof o&&(o=(o=o.trim())||void 0),a[e]={operator:(null===(r=n[e])||void 0===r?void 0:r.operator)||"LIKE",value:o}})),a}(e)),y.current=g;var h=!!(null===(p=null===(f=null===(d=s.domainModel)||void 0===d?void 0:d.query)||void 0===f?void 0:f.abilitySet)||void 0===p?void 0:p.includes("PAGE"));(function(e,t,n,a){var r=a.query,o=a.pageParams,i=a.ordersParams,u=n.fields,l=void 0===u?[]:u,c=new Set;return l.forEach((function(e){var t,n=(null===(t=null==e?void 0:e.name)||void 0===t?void 0:t.split("."))||[];n.length>1&&c.add(n[n.length-2])})),c.forEach((function(e){l.push({name:e})})),new Promise((function(n,a){e?e(t,"SELECT",{query:r,fields:l,orders:i,page:o.usePagination?{pageNum:o.pageNum,pageSize:o.pageSize}:void 0}).then((function(e){1===e.code?n({dataSource:e.data.dataSource,pageNum:e.data.pageNum,pageSize:e.data.pageSize,total:e.data.total}):a(e.msg||"请求错误，请稍候再试~")})).catch((function(e){console.error(e),a("请求错误，请稍候再试~")})):a("env.callDomainModel 未实现")}))})(c.callDomainModel,s.domainModel,{fields:z(null===(E=null===(v=s.domainModel)||void 0===v?void 0:v.query)||void 0===E?void 0:E.entity).map((function(e){return{name:e.label}}))},{query:g,pageParams:{pageNum:t.pageNum,pageSize:t.pageSize,usePagination:h},ordersParams:C.length?C:[{fieldName:"id",order:"DESC"}]}).then((function(e){var o,i,u=h?{dataSource:e.dataSource,total:e.total,pageNum:t.pageNum}:e.dataSource;null===(i=null===(o=null==m?void 0:m.current)||void 0===o?void 0:o.dataSource)||void 0===i||i.call(o,u),a&&(n?a[x.QUERY.THEN](u):a[x.PAGE_CHANGE.THEN](u)),r(u)})).catch((function(e){u.message.error(e),a&&(n?a[x.QUERY.CATCH](e):a[x.PAGE_CHANGE.CATCH](e)),o(e)})).finally((function(){var e,t;null===(t=null===(e=null==m?void 0:m.current)||void 0===e?void 0:e.endLoading)||void 0===t||t.call(e)}))}))};return n.default.createElement("div",{className:b.domainContainer,ref:p},s.domainModel?n.default.createElement(n.default.Fragment,null,(void 0===(null===(r=null==s?void 0:s.queryContent)||void 0===r?void 0:r.visible)||(null===(o=null==s?void 0:s.queryContent)||void 0===o?void 0:o.visible))&&n.default.createElement(k,{slots:f,data:s,env:c,formInputs:E,formOutputs:g,getListData:A,onActionClick:S}),n.default.createElement(G,{env:c,actions:s.actions,slots:f}),n.default.createElement("div",{className:b.tableContent},0===f.tableContent.size&&c.edit?n.default.createElement(N,{slot:null===(i=f.tableContent)||void 0===i?void 0:i.render(),description:"请拖拽组件到列表展示区"}):null===(l=f.tableContent)||void 0===l?void 0:l.render({wrap:function(e){return null==e?void 0:e.map((function(e,t){return m.current=e.inputs,v.current=e.outputs,e.jsx}))},outputs:{pageChange:H({eventName:"pageChange",getOutputs:function(){return v.current},cb:function(e){C.current=e.pageNum,A(y.current,{pageNum:e.pageNum,pageSize:s.pageSize})}})}}))):n.default.createElement("div",{className:b.empty},n.default.createElement(u.Empty,{description:"请选择一个领域模型实体"})))}var k=function(e){var t,a,r=e.formInputs,o=e.formOutputs,i=e.slots,l=e.env,c=e.data,s=e.getListData,d=e.onActionClick;return n.default.createElement(n.default.Fragment,null,0===i.queryContent.size&&l.edit?n.default.createElement("div",{style:{position:"relative"}},n.default.createElement(N,{slot:null===(t=i.queryContent)||void 0===t?void 0:t.render(),description:"请拖拽组件到查询区"})):0!==i.queryContent.size&&n.default.createElement("div",{className:b.queryContent},n.default.createElement("div",{className:b.queryContentLeft},null===(a=i.queryContent)||void 0===a?void 0:a.render({wrap:function(e){return null==e?void 0:e.map((function(e,t){return r.current=e.inputs,o.current=e.outputs,e.jsx}))},outputs:{onClickSubmit:H({eventName:"onClickSubmit",getOutputs:function(){return o.current},cb:function(e){s(e,{pageNum:1,pageSize:c.pageSize},!0)}})}})),n.default.createElement("div",{className:b.queryContentRight},c.queryActions.items.map((function(e){return n.default.createElement(u.Button,{"data-query-action":e.key,type:e.type,key:e.key,loading:e.loading,onClick:function(){return d(e)}},e.title)})))))},G=function(e){var t,a,r=e.env,o=e.actions,i=e.slots;return e.abilitySet,e.onActionClick,n.default.createElement(n.default.Fragment,null,o.useSlot&&(0===i.actionsContent.size&&r.edit?n.default.createElement("div",{className:b.actionsContent},n.default.createElement(N,{slot:null===(t=i.actionsContent)||void 0===t?void 0:t.render(),description:"请拖拽组件到操作区（新建按钮或者其他操作）"})):i.actionsContent.size>0&&n.default.createElement("div",{className:b.actionsContent},null===(a=i.actionsContent)||void 0===a?void 0:a.render())))};function F(e,t){return null==e?void 0:e.includes(t)}})();var i=o.A;export{i as default};