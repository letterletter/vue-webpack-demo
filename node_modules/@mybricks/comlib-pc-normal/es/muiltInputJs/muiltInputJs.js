var t={d:(o,e)=>{for(var n in e)t.o(e,n)&&!t.o(o,n)&&Object.defineProperty(o,n,{enumerable:!0,get:e[n]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o)},o={};t.d(o,{A:()=>v});var e=function(t,o,e){if(e||2===arguments.length)for(var n,r=0,i=o.length;r<i;r++)!n&&r in o||(n||(n=Array.prototype.slice.call(o,0,r)),n[r]=o[r]);return t.concat(n||Array.prototype.slice.call(o))},n=window.setInterval,r=window.clearInterval,i=window.setTimeout,a=window.clearTimeout,c=window,u=new WeakMap,s=new WeakMap,p=new WeakMap,l={undefined:!0,Array:!0,Object:!0,String:!0,Boolean:!0,Math:!0,Number:!0,Symbol:!0,parseFloat:!0,Float32Array:!0};function f(){var t={};return Object.getOwnPropertyNames(c).forEach((function(o){var e=Object.getOwnPropertyDescriptor(c,o);if(e&&!e.configurable){var n=Object.prototype.hasOwnProperty.call(e,"get");"top"!==o&&"parent"!==o&&"self"!==o&&"window"!==o||(e.configurable=!0,n||(e.writable=!0)),Object.defineProperty(t,o,Object.freeze(e))}})),t}const y=function(){function t(t){void 0===t&&(t={});var o=this;this.hasDisposed=!1,this.fakeWindow=f(),this.timeoutList=[],this.intervalList=[],this.options={},this.options=t||{},this.proxy=new Proxy(window,{set:function(t,e,n){if(!o.hasDisposed)try{!o.fakeWindow.hasOwnProperty(e)&&t.hasOwnProperty(e)&&(r=e,i=o.fakeWindow,(a=Object.getOwnPropertyDescriptor(window,r))&&a.writable&&Object.defineProperty(i,r,{configurable:a.configurable,enumerable:a.enumerable,writable:a.writable,value:a.value})),o.fakeWindow[e]=n}catch(t){throw console.error("set-key-error",e,t),t}var r,i,a;return!0},get:function(t,e){if(e===Symbol.unscopables)return l;if("window"===e||"self"===e)return o.proxy;if("document"!==e){if("hasOwnProperty"===e)return t.hasOwnProperty;if("eval"===e)return t.eval;if("location"===e)return t.location;try{var n=e in o.fakeWindow?o.fakeWindow[e]:t[e];return"function"!=typeof n||function(t){if(s.has(t))return s.get(t);var o=0===t.name.indexOf("bound ")&&!t.hasOwnProperty("prototype");return s.set(t,o),o}(n)||function(t){if(u.has(t))return u.get(t);var o=t.prototype&&t.prototype.constructor===t&&Object.getOwnPropertyNames(t.prototype).length>1||/^function\b\s[A-Z].*/.test(t.toString())||/^class\b/.test(t.toString());return u.set(t,o),o}(n)?n:(n=Function.prototype.bind.call(n,t),function(t,o){var e=p.get(o);if(e)return e;var n=Function.prototype.bind.call(o,t);for(var r in o)n[r]=o[r];return o.hasOwnProperty("prototype")&&!n.hasOwnProperty("prototype")&&(n.prototype=o.prototype),p.set(o,n),n}(window,n))}catch(t){throw console.error("get-key-error",e,t),t}}},has:function(t,e){return!o.options.module||"params"!==e&&"cb"!==e}}),this.proxy.setTimeout=function(t,n){for(var r=[],a=2;a<arguments.length;a++)r[a-2]=arguments[a];if(o.hasDisposed)return 0;var c=i.apply(void 0,e([t,n],r,!1));return o.timeoutList.push(c),c},this.proxy.clearTimeout=function(t){var e=o.timeoutList.indexOf(t);return-1!==e&&o.timeoutList.splice(e,1),a(t)},this.proxy.setInterval=function(t,r){for(var i=[],a=2;a<arguments.length;a++)i[a-2]=arguments[a];if(o.hasDisposed)return 0;var c=n.apply(void 0,e([t,r],i,!1));return o.intervalList.push(c),c},this.proxy.clearInterval=function(t){var e=o.intervalList.indexOf(t);return-1!==e&&o.intervalList.splice(e,1),r(t)},c.proxy=this.proxy}return t.prototype.compile=function(t){if(this.hasDisposed)throw new Error("sandbox has been destroyed");var o,e=this.options.module;o=e?function(t){return"(\n                function(window, params, cb) {\n                    with(window) {\n                        return (".concat(t,")(...params, cb)\n                    }\n                }\n            )")}(t):function(t){return"(\n                function(window) {\n                    with(window){\n                        ".concat(t,"\n                    } \n                }\n            ).bind(window.proxy)\n        ")}(t);var n=c.eval("".concat(o,";//@ sourceURL=sandbox-code.js"));return{run:function(t,o){try{return e?n(window.proxy,t,o):n(window.proxy)}catch(t){throw console.error("js sandbox error occur:",t),t}}}},t.prototype.dispose=function(){this.timeoutList.forEach((function(t){window.clearTimeout(t)})),this.timeoutList=[],this.intervalList.forEach((function(t){return r(t)})),this.intervalList=[],this.fakeWindow=f(),this.options={},delete c.proxy,this.hasDisposed=!0,console.log("Sandbox was successfully destroyed")},t}();function d(t){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d(t)}function h(t,o,e){var n,r=e||{},i=r.env,a=r.callback,c=void 0===a?function(){}:a,u=(null==i?void 0:i.runtime)&&!(null===(n=null==i?void 0:i.runtime)||void 0===n?void 0:n.debug);"object"===d(t)&&(t=u&&(null==t?void 0:t.transformCode)||(null==t?void 0:t.code));var s=null;if(o&&o.length){var p=new y({module:!0}),l=decodeURIComponent(t);s=/export\s+default.*async.*function.*\(/g.test(l)?p.compile("".concat(l.replace(/export\s+default.*function.*\(/g,"async function _RT_("))):p.compile("".concat(l.replace(/export\s+default.*function.*\(/g,"function _RT_(")))}else s=(p=new y).compile("".concat(decodeURIComponent(t)));return s.run(o,c)}!function(){function t(t){this.options={},String.prototype.matchAll||(String.prototype.matchAll=function(t){for(var o,e=[];null!=(o=t.exec(this));)e.push(o);return e}),this.options=t}t.prototype.unscopeCompileCode=function(t,o){return void 0===t&&(t="context"),new Function(t,"with(".concat(t,"){\n            return ").concat(o,"\n        }"))},t.prototype.scopeCompileCode=function(t){var o=this,e=this.unscopeCompileCode(this.options.prefix,t);return function(t){var n,r=o.options.prefix?((n={})[o.options.prefix]=t,n):t,i=new Proxy(r,{has:function(t,o){return!0},get:function(t,o,e){if(o!==Symbol.unscopables)return Reflect.get(t,o,e)}});return e(i)}},t.prototype.execute=function(t){var o,e=this.scopeCompileCode(t),n=null!==(o=this.options.context)&&void 0!==o?o:{};return e.call(this,n)},t.prototype.executeWithTemplate=function(t){var o=this,e=t.matchAll(/\{([^\{\}]*?|.+)\}/g),n=Array.from(e);if(!n.length)return t;var r=n.map((function(t){var e=t[0],n=t.input,r=t[1];return r.trim()&&(r=o.execute(r)),{match:e,ret:r,input:n}}));if(1===r.length&&r[0].input===r[0].match)return r[0].ret;var i=r.reduce((function(o,e){var n=e.match,r=e.ret;return n===t&&void 0===r?r:o.replace(n,"string"==typeof r?r:JSON.stringify(r))}),t);try{return JSON.parse(i)}catch(t){return i}}}();var w=function(){return w=Object.assign||function(t){for(var o,e=1,n=arguments.length;e<n;e++)for(var r in o=arguments[e])Object.prototype.hasOwnProperty.call(o,r)&&(t[r]=o[r]);return t},w.apply(this,arguments)};function v(t){var o=t.env,e=t.data,n=t.inputs,r=t.outputs,i=t.logger,a=t.onError,c=e.fns,u=e.runImmediate,s={outputs:r};try{u&&o.runtime&&h(c,[s]),n.input((function(t){try{h(c,[w(w({},s),{inputs:t})])}catch(t){null==a||a(t),console.error("js计算组件运行错误.",t),i.error("".concat(t))}}))}catch(t){null==a||a(t),console.error("js计算组件运行错误.",t),i.error("".concat(t))}}var m=o.A;export{m as default};