var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};t.d(e,{A:()=>w});var r=function(t,e,r){if(r||2===arguments.length)for(var n,o=0,i=e.length;o<i;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))},n=window.setInterval,o=window.clearInterval,i=window.setTimeout,a=window.clearTimeout,s=window,c=new WeakMap,u=new WeakMap,p=new WeakMap,l={undefined:!0,Array:!0,Object:!0,String:!0,Boolean:!0,Math:!0,Number:!0,Symbol:!0,parseFloat:!0,Float32Array:!0};function f(){var t={};return Object.getOwnPropertyNames(s).forEach((function(e){var r=Object.getOwnPropertyDescriptor(s,e);if(r&&!r.configurable){var n=Object.prototype.hasOwnProperty.call(r,"get");"top"!==e&&"parent"!==e&&"self"!==e&&"window"!==e||(r.configurable=!0,n||(r.writable=!0)),Object.defineProperty(t,e,Object.freeze(r))}})),t}!function(){function t(t){void 0===t&&(t={});var e=this;this.hasDisposed=!1,this.fakeWindow=f(),this.timeoutList=[],this.intervalList=[],this.options={},this.options=t||{},this.proxy=new Proxy(window,{set:function(t,r,n){if(!e.hasDisposed)try{!e.fakeWindow.hasOwnProperty(r)&&t.hasOwnProperty(r)&&(o=r,i=e.fakeWindow,(a=Object.getOwnPropertyDescriptor(window,o))&&a.writable&&Object.defineProperty(i,o,{configurable:a.configurable,enumerable:a.enumerable,writable:a.writable,value:a.value})),e.fakeWindow[r]=n}catch(t){throw console.error("set-key-error",r,t),t}var o,i,a;return!0},get:function(t,r){if(r===Symbol.unscopables)return l;if("window"===r||"self"===r)return e.proxy;if("document"!==r){if("hasOwnProperty"===r)return t.hasOwnProperty;if("eval"===r)return t.eval;if("location"===r)return t.location;try{var n=r in e.fakeWindow?e.fakeWindow[r]:t[r];return"function"!=typeof n||function(t){if(u.has(t))return u.get(t);var e=0===t.name.indexOf("bound ")&&!t.hasOwnProperty("prototype");return u.set(t,e),e}(n)||function(t){if(c.has(t))return c.get(t);var e=t.prototype&&t.prototype.constructor===t&&Object.getOwnPropertyNames(t.prototype).length>1||/^function\b\s[A-Z].*/.test(t.toString())||/^class\b/.test(t.toString());return c.set(t,e),e}(n)?n:(n=Function.prototype.bind.call(n,t),function(t,e){var r=p.get(e);if(r)return r;var n=Function.prototype.bind.call(e,t);for(var o in e)n[o]=e[o];return e.hasOwnProperty("prototype")&&!n.hasOwnProperty("prototype")&&(n.prototype=e.prototype),p.set(e,n),n}(window,n))}catch(t){throw console.error("get-key-error",r,t),t}}},has:function(t,r){return!e.options.module||"params"!==r&&"cb"!==r}}),this.proxy.setTimeout=function(t,n){for(var o=[],a=2;a<arguments.length;a++)o[a-2]=arguments[a];if(e.hasDisposed)return 0;var s=i.apply(void 0,r([t,n],o,!1));return e.timeoutList.push(s),s},this.proxy.clearTimeout=function(t){var r=e.timeoutList.indexOf(t);return-1!==r&&e.timeoutList.splice(r,1),a(t)},this.proxy.setInterval=function(t,o){for(var i=[],a=2;a<arguments.length;a++)i[a-2]=arguments[a];if(e.hasDisposed)return 0;var s=n.apply(void 0,r([t,o],i,!1));return e.intervalList.push(s),s},this.proxy.clearInterval=function(t){var r=e.intervalList.indexOf(t);return-1!==r&&e.intervalList.splice(r,1),o(t)},s.proxy=this.proxy}t.prototype.compile=function(t){if(this.hasDisposed)throw new Error("sandbox has been destroyed");var e,r=this.options.module;e=r?function(t){return"(\n                function(window, params, cb) {\n                    with(window) {\n                        return (".concat(t,")(...params, cb)\n                    }\n                }\n            )")}(t):function(t){return"(\n                function(window) {\n                    with(window){\n                        ".concat(t,"\n                    } \n                }\n            ).bind(window.proxy)\n        ")}(t);var n=s.eval("".concat(e,";//@ sourceURL=sandbox-code.js"));return{run:function(t,e){try{return r?n(window.proxy,t,e):n(window.proxy)}catch(t){throw console.error("js sandbox error occur:",t),t}}}},t.prototype.dispose=function(){this.timeoutList.forEach((function(t){window.clearTimeout(t)})),this.timeoutList=[],this.intervalList.forEach((function(t){return o(t)})),this.intervalList=[],this.fakeWindow=f(),this.options={},delete s.proxy,this.hasDisposed=!0,console.log("Sandbox was successfully destroyed")}}();const h=function(){function t(t){this.options={},String.prototype.matchAll||(String.prototype.matchAll=function(t){for(var e,r=[];null!=(e=t.exec(this));)r.push(e);return r}),this.options=t}return t.prototype.unscopeCompileCode=function(t,e){return void 0===t&&(t="context"),new Function(t,"with(".concat(t,"){\n            return ").concat(e,"\n        }"))},t.prototype.scopeCompileCode=function(t){var e=this,r=this.unscopeCompileCode(this.options.prefix,t);return function(t){var n,o=e.options.prefix?((n={})[e.options.prefix]=t,n):t,i=new Proxy(o,{has:function(t,e){return!0},get:function(t,e,r){if(e!==Symbol.unscopables)return Reflect.get(t,e,r)}});return r(i)}},t.prototype.execute=function(t){var e,r=this.scopeCompileCode(t),n=null!==(e=this.options.context)&&void 0!==e?e:{};return r.call(this,n)},t.prototype.executeWithTemplate=function(t){var e=this,r=t.matchAll(/\{([^\{\}]*?|.+)\}/g),n=Array.from(r);if(!n.length)return t;var o=n.map((function(t){var r=t[0],n=t.input,o=t[1];return o.trim()&&(o=e.execute(o)),{match:r,ret:o,input:n}}));if(1===o.length&&o[0].input===o[0].match)return o[0].ret;var i=o.reduce((function(e,r){var n=r.match,o=r.ret;return n===t&&void 0===o?o:e.replace(n,"string"==typeof o?o:JSON.stringify(o))}),t);try{return JSON.parse(i)}catch(t){return i}},t}();function w(t){var e=t.data,r=t.inputs,n=t.outputs,o=t.onError;r.inputContext((function(t){var r=new h({context:t,prefix:"inputValue"});e.picks.map((function(e){var i=e.key,a=e.expression,s=e.title;if(a)try{var c=r.executeWithTemplate(a);n[i](c)}catch(t){null==o||o("[".concat(s,"(").concat(i,")]: ").concat(t))}else n[i](t)}))}))}var y=e.A;export{y as default};