var t={d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};t.d(e,{A:()=>v});var n=function(t,e,n){if(n||2===arguments.length)for(var o,r=0,i=e.length;r<i;r++)!o&&r in e||(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))},o=window.setInterval,r=window.clearInterval,i=window.setTimeout,a=window.clearTimeout,c=window,u=new WeakMap,s=new WeakMap,p=new WeakMap,l={undefined:!0,Array:!0,Object:!0,String:!0,Boolean:!0,Math:!0,Number:!0,Symbol:!0,parseFloat:!0,Float32Array:!0};function f(){var t={};return Object.getOwnPropertyNames(c).forEach((function(e){var n=Object.getOwnPropertyDescriptor(c,e);if(n&&!n.configurable){var o=Object.prototype.hasOwnProperty.call(n,"get");"top"!==e&&"parent"!==e&&"self"!==e&&"window"!==e||(n.configurable=!0,o||(n.writable=!0)),Object.defineProperty(t,e,Object.freeze(n))}})),t}const y=function(){function t(t){void 0===t&&(t={});var e=this;this.hasDisposed=!1,this.fakeWindow=f(),this.timeoutList=[],this.intervalList=[],this.options={},this.options=t||{},this.proxy=new Proxy(window,{set:function(t,n,o){if(!e.hasDisposed)try{!e.fakeWindow.hasOwnProperty(n)&&t.hasOwnProperty(n)&&(r=n,i=e.fakeWindow,(a=Object.getOwnPropertyDescriptor(window,r))&&a.writable&&Object.defineProperty(i,r,{configurable:a.configurable,enumerable:a.enumerable,writable:a.writable,value:a.value})),e.fakeWindow[n]=o}catch(t){throw console.error("set-key-error",n,t),t}var r,i,a;return!0},get:function(t,n){if(n===Symbol.unscopables)return l;if("window"===n||"self"===n)return e.proxy;if("document"!==n){if("hasOwnProperty"===n)return t.hasOwnProperty;if("eval"===n)return t.eval;if("location"===n)return t.location;try{var o=n in e.fakeWindow?e.fakeWindow[n]:t[n];return"function"!=typeof o||function(t){if(s.has(t))return s.get(t);var e=0===t.name.indexOf("bound ")&&!t.hasOwnProperty("prototype");return s.set(t,e),e}(o)||function(t){if(u.has(t))return u.get(t);var e=t.prototype&&t.prototype.constructor===t&&Object.getOwnPropertyNames(t.prototype).length>1||/^function\b\s[A-Z].*/.test(t.toString())||/^class\b/.test(t.toString());return u.set(t,e),e}(o)?o:(o=Function.prototype.bind.call(o,t),function(t,e){var n=p.get(e);if(n)return n;var o=Function.prototype.bind.call(e,t);for(var r in e)o[r]=e[r];return e.hasOwnProperty("prototype")&&!o.hasOwnProperty("prototype")&&(o.prototype=e.prototype),p.set(e,o),o}(window,o))}catch(t){throw console.error("get-key-error",n,t),t}}},has:function(t,n){return!e.options.module||"params"!==n&&"cb"!==n}}),this.proxy.setTimeout=function(t,o){for(var r=[],a=2;a<arguments.length;a++)r[a-2]=arguments[a];if(e.hasDisposed)return 0;var c=i.apply(void 0,n([t,o],r,!1));return e.timeoutList.push(c),c},this.proxy.clearTimeout=function(t){var n=e.timeoutList.indexOf(t);return-1!==n&&e.timeoutList.splice(n,1),a(t)},this.proxy.setInterval=function(t,r){for(var i=[],a=2;a<arguments.length;a++)i[a-2]=arguments[a];if(e.hasDisposed)return 0;var c=o.apply(void 0,n([t,r],i,!1));return e.intervalList.push(c),c},this.proxy.clearInterval=function(t){var n=e.intervalList.indexOf(t);return-1!==n&&e.intervalList.splice(n,1),r(t)},c.proxy=this.proxy}return t.prototype.compile=function(t){if(this.hasDisposed)throw new Error("sandbox has been destroyed");var e,n=this.options.module;e=n?function(t){return"(\n                function(window, params, cb) {\n                    with(window) {\n                        return (".concat(t,")(...params, cb)\n                    }\n                }\n            )")}(t):function(t){return"(\n                function(window) {\n                    with(window){\n                        ".concat(t,"\n                    } \n                }\n            ).bind(window.proxy)\n        ")}(t);var o=c.eval("".concat(e,";//@ sourceURL=sandbox-code.js"));return{run:function(t,e){try{return n?o(window.proxy,t,e):o(window.proxy)}catch(t){throw console.error("js sandbox error occur:",t),t}}}},t.prototype.dispose=function(){this.timeoutList.forEach((function(t){window.clearTimeout(t)})),this.timeoutList=[],this.intervalList.forEach((function(t){return r(t)})),this.intervalList=[],this.fakeWindow=f(),this.options={},delete c.proxy,this.hasDisposed=!0,console.log("Sandbox was successfully destroyed")},t}();function d(t){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d(t)}function h(t,e,n){var o,r=n||{},i=r.env,a=r.callback,c=void 0===a?function(){}:a,u=(null==i?void 0:i.runtime)&&!(null===(o=null==i?void 0:i.runtime)||void 0===o?void 0:o.debug);"object"===d(t)&&(t=u&&(null==t?void 0:t.transformCode)||(null==t?void 0:t.code));var s=null;if(e&&e.length){var p=new y({module:!0}),l=decodeURIComponent(t);s=/export\s+default.*async.*function.*\(/g.test(l)?p.compile("".concat(l.replace(/export\s+default.*function.*\(/g,"async function _RT_("))):p.compile("".concat(l.replace(/export\s+default.*function.*\(/g,"function _RT_(")))}else s=(p=new y).compile("".concat(decodeURIComponent(t)));return s.run(e,c)}!function(){function t(t){this.options={},String.prototype.matchAll||(String.prototype.matchAll=function(t){for(var e,n=[];null!=(e=t.exec(this));)n.push(e);return n}),this.options=t}t.prototype.unscopeCompileCode=function(t,e){return void 0===t&&(t="context"),new Function(t,"with(".concat(t,"){\n            return ").concat(e,"\n        }"))},t.prototype.scopeCompileCode=function(t){var e=this,n=this.unscopeCompileCode(this.options.prefix,t);return function(t){var o,r=e.options.prefix?((o={})[e.options.prefix]=t,o):t,i=new Proxy(r,{has:function(t,e){return!0},get:function(t,e,n){if(e!==Symbol.unscopables)return Reflect.get(t,e,n)}});return n(i)}},t.prototype.execute=function(t){var e,n=this.scopeCompileCode(t),o=null!==(e=this.options.context)&&void 0!==e?e:{};return n.call(this,o)},t.prototype.executeWithTemplate=function(t){var e=this,n=t.matchAll(/\{([^\{\}]*?|.+)\}/g),o=Array.from(n);if(!o.length)return t;var r=o.map((function(t){var n=t[0],o=t.input,r=t[1];return r.trim()&&(r=e.execute(r)),{match:n,ret:r,input:o}}));if(1===r.length&&r[0].input===r[0].match)return r[0].ret;var i=r.reduce((function(e,n){var o=n.match,r=n.ret;return o===t&&void 0===r?r:e.replace(o,"string"==typeof r?r:JSON.stringify(r))}),t);try{return JSON.parse(i)}catch(t){return i}}}();var w=function(){return w=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},w.apply(this,arguments)};function v(t){var e=t.env,n=t.data,o=t.inputs,r=t.outputs,i=t.logger,a=t.onError,c=(n.transformCode,n.fnBody,n.fns),u=(n.fnParams,n.runImmediate),s={outputs:r},p=new Set,l=Object.keys(o).length,f={};try{u&&e.runtime&&h(c,[s]),Object.keys(o).forEach((function(t,e){o[t]((function(e){if(p.add(t),f[t.replace("input","inputValue")]=e,p.size===l){p.clear();try{h(c,[w(w({},s),{inputs:w({},f),inputValue:f.inputValue0})]),f={}}catch(t){null==a||a(t),console.error("js计算组件运行错误.",t),i.error("".concat(t))}}}))}))}catch(t){null==a||a(t),console.error("js计算组件运行错误.",t),i.error("".concat(t))}}var m=e.A;export{m as default};