!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["@mybricks/comlib-basic"]=e():t["@mybricks/comlib-basic"]=e()}(self,(()=>(()=>{"use strict";var t={d:(e,o)=>{for(var n in o)t.o(o,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function n(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,r(n.key),n)}}function r(t){var e=function(t,e){if("object"!=o(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==o(e)?e:String(e)}t.r(e),t.d(e,{default:()=>x});var i=window.setInterval,a=window.clearInterval,c=window.setTimeout,u=window.clearTimeout,s=window,l=new WeakMap,f=new WeakMap,p=new WeakMap,y={undefined:!0,Array:!0,Object:!0,String:!0,Boolean:!0,Math:!0,Number:!0,Symbol:!0,parseFloat:!0,Float32Array:!0};function d(t){for(;t.trim().endsWith(";");)t=t.slice(0,t.length-1);return t}function w(){var t={};return Object.getOwnPropertyNames(s).forEach((function(e){var o=Object.getOwnPropertyDescriptor(s,e);if(o&&!o.configurable){var n=Object.prototype.hasOwnProperty.call(o,"get");"top"!==e&&"parent"!==e&&"self"!==e&&"window"!==e||(o.configurable=!0,n||(o.writable=!0)),Object.defineProperty(t,e,Object.freeze(o))}})),t}const b=function(){function t(){var e=this,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.hasDisposed=!1,this.fakeWindow=w(),this.timeoutList=[],this.intervalList=[],this.options={},this.options=o||{},this.proxy=new Proxy(window,{set:function(t,o,n){if(!e.hasDisposed)try{!e.fakeWindow.hasOwnProperty(o)&&t.hasOwnProperty(o)&&(r=o,i=e.fakeWindow,(a=Object.getOwnPropertyDescriptor(window,r))&&a.writable&&Object.defineProperty(i,r,{configurable:a.configurable,enumerable:a.enumerable,writable:a.writable,value:a.value})),e.fakeWindow[o]=n}catch(t){throw console.error("set-key-error",o,t),t}var r,i,a;return!0},get:function(t,o){if(o===Symbol.unscopables)return y;if("window"===o||"self"===o)return e.proxy;if("document"!==o){if("hasOwnProperty"===o)return t.hasOwnProperty;if("eval"===o)return t.eval;if("location"===o)return t.location;try{var n=o in e.fakeWindow?e.fakeWindow[o]:t[o];return"function"!=typeof n||function(t){if(f.has(t))return f.get(t);var e=0===t.name.indexOf("bound ")&&!t.hasOwnProperty("prototype");return f.set(t,e),e}(n)||function(t){if(l.has(t))return l.get(t);var e=t.prototype&&t.prototype.constructor===t&&Object.getOwnPropertyNames(t.prototype).length>1||/^function\b\s[A-Z].*/.test(t.toString())||/^class\b/.test(t.toString());return l.set(t,e),e}(n)?n:(n=Function.prototype.bind.call(n,t),function(t,e){var o=p.get(e);if(o)return o;var n=Function.prototype.bind.call(e,t);for(var r in e)n[r]=e[r];return e.hasOwnProperty("prototype")&&!n.hasOwnProperty("prototype")&&(n.prototype=e.prototype),p.set(e,n),n}(window,n))}catch(t){throw console.error("get-key-error",o,t),t}}},has:function(t,o){return!e.options.module||"params"!==o&&"cb"!==o}}),this.proxy.setTimeout=function(t,o){if(e.hasDisposed)return 0;for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var a=c.apply(void 0,[t,o].concat(r));return e.timeoutList.push(a),a},this.proxy.clearTimeout=function(t){var o=e.timeoutList.indexOf(t);return-1!==o&&e.timeoutList.splice(o,1),u(t)},this.proxy.setInterval=function(t,o){if(e.hasDisposed)return 0;for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];var c=i.apply(void 0,[t,o].concat(r));return e.intervalList.push(c),c},this.proxy.clearInterval=function(t){var o=e.intervalList.indexOf(t);return-1!==o&&e.intervalList.splice(o,1),a(t)},s.proxy=this.proxy}var e,o;return e=t,(o=[{key:"compile",value:function(t){if(this.hasDisposed)throw new Error("sandbox has been destroyed");var e,o=this.options.module;e=o?function(t){return t=d(t),"(\n                function(window, params, cb) {\n                    with(window) {\n                        return (".concat(t,")(...params, cb)\n                    }\n                }\n            )")}(t):function(t){return t=d(t),"(\n                function(window) {\n                    with(window){\n                        ".concat(t,"\n                    } \n                }\n            ).bind(window.proxy)\n        ")}(t);var n=s.eval("".concat(e,";//@ sourceURL=sandbox-code.js"));return{run:function(t,e){try{return o?n(window.proxy,t,e):n(window.proxy)}catch(t){throw console.error("js sandbox error occur:",t),t}}}}},{key:"dispose",value:function(){this.timeoutList.forEach((function(t){window.clearTimeout(t)})),this.timeoutList=[],this.intervalList.forEach((function(t){return a(t)})),this.intervalList=[],this.fakeWindow=w(),this.options={},delete s.proxy,this.hasDisposed=!0}}])&&n(e.prototype,o),Object.defineProperty(e,"prototype",{writable:!1}),t}();function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}var m=function(t){try{return decodeURIComponent(t)}catch(e){return t}},h=function(t){try{return encodeURIComponent(t)}catch(e){return t}};function g(t,e,o){var n,r,i,a=(o||{}).callback,c=void 0===a?function(){}:a;if("object"===v(t)&&null!==t&&(t=null!==(n=null==t?void 0:t.transformCode)&&void 0!==n?n:null==t?void 0:t.code),(null==t?void 0:t.includes("var%20_RTFN_"))||(t=O(t)),e&&e.length){i=new b({module:!0});var u=m(t);r=/export\s+default.*async.*function.*\(/g.test(u)?i.compile("".concat(u.replace(/export\s+default.*function.*\(/g,"async function _RT_("))):i.compile("".concat(u.replace(/export\s+default.*function.*\(/g,"function _RT_(")))}else r=(i=new b).compile("".concat(m(t)));return r.run(e,c),i}var O=function(t){t=m(t);try{if(!window.Babel)throw Error("Babel was not found in window");var e=window.Babel.transform("_RTFN_ = ".concat(t," "),{presets:["env","typescript"],parserOpts:{strictMode:!1},comments:!1,filename:"types.d.ts"}).code;return e="(function() { var _RTFN_; \n".concat(e,"\n return _RTFN_; })()"),h(e)}catch(e){return console.error(e),h(t)}};function j(t){var e=[];return Object.keys(t).sort((function(t,e){var o,n;return+((null===(o=null==t?void 0:t.match(/\d+/g))||void 0===o?void 0:o[0])||0)-+((null===(n=null==e?void 0:e.match(/\d+/g))||void 0===n?void 0:n[0])||0)})).forEach((function(o){e.push(t[o])})),e}function x(t){var e,o,n=t.env,r=t.data,i=t.inputs,a=t.outputs,c=t.logger,u=t.onError,s=r.fns,l=r.runImmediate,f={outputs:j(a)};try{l&&n.runtime&&(o=g(s,[f])),i.input((function(t){try{o=g(s,[Object.assign(Object.assign({},f),{inputs:j(t)})])}catch(t){null==u||u(t),console.error("js计算组件运行错误.",t),c.error("".concat(t))}})),"function"==typeof(null===(e=null==n?void 0:n.runtime)||void 0===e?void 0:e.onComplete)&&n.runtime.onComplete((function(){null==o||o.dispose()}))}catch(t){null==u||u(t),console.error("js计算组件运行错误.",t),c.error("".concat(t))}}return e})()));